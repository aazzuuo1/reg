<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- باقي الهيدر كما هو -->
</head>
<body>
  <!-- باقي الهيكل HTML كما هو -->
  
  <script>
    /* ========== عناصر DOM ========= */
    const loginTab = document.getElementById('loginTab');
    const registerTab = document.getElementById('registerTab');
    const loginCard = document.getElementById('loginCard');
    const registerCard = document.getElementById('registerCard');
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const loginWarning = document.getElementById('loginWarning');
    const loginError = document.getElementById('loginError');

    /* ========== تبديل التبويبات ========= */
    // كما كان...

    /* ========== تخزين المستخدم محلياً ========= */
    function saveUser(email, password) {
      // نستخدم JSON.stringify للحفاظ على القيمة كما هي
      localStorage.setItem('userData', JSON.stringify({
        email: email.trim().toLowerCase(),
        password: password
      }));
    }

    function getUserData() {
      const userData = localStorage.getItem('userData');
      return userData ? JSON.parse(userData) : null;
    }

    /* ========== معالجة التسجيل ========= */
    registerForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      const email = regEmail.value.trim();
      const pass1 = regPass.value;
      const pass2 = regPass2.value;
      
      if (pass1 !== pass2) {
        alert('كلمتا المرور غير متطابقتين');
        return;
      }
      
      saveUser(email, pass1);
      alert('تم التسجيل بنجاح! يمكنك تسجيل الدخول الآن.');
      
      // تفريغ الحقول والتبديل للشاشة
      regEmail.value = '';
      regPass.value = '';
      regPass2.value = '';
      switchScreen(true);
    });

    /* ========== معالجة تسجيل الدخول ========= */
    loginForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      loginWarning.classList.add('hidden');
      loginError.classList.add('hidden');
      
      const userData = getUserData();
      
      if (!userData) {
        loginWarning.classList.remove('hidden');
        switchScreen(false);
        return;
      }
      
      const enteredEmail = loginEmail.value.trim().toLowerCase();
      const enteredPass = loginPass.value;
      
      console.log('المدخل:', enteredEmail, enteredPass);
      console.log('المخزن:', userData.email, userData.password);
      
      if (enteredEmail === userData.email && enteredPass === userData.password) {
        window.location.href = 'home.html';
      } else {
        loginError.classList.remove('hidden');
        console.log('سبب الخطأ:',
          'البريد متطابق؟', enteredEmail === userData.email,
          'كلمة المرور متطابقة؟', enteredPass === userData.password);
      }
    });
  </script>
</body>
</html>
